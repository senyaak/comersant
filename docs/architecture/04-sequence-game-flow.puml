@startuml Game_Data_Flow
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Dynamic.puml

LAYOUT_WITH_LEGEND()

title Sequence Diagram - Game Turn Flow

Person(player1, "Player 1", "Active player")
Person(player2, "Player 2", "Waiting player")

Container(angular1, "Angular App (P1)", "Frontend")
Container(angular2, "Angular App (P2)", "Frontend")
Container(gameGateway, "Game Gateway", "WebSocket Handler")
Container(gameEngine, "Game Engine", "Core Logic")

Rel(player1, angular1, "Click 'Roll Dice'", "UI Event")
Rel(angular1, gameGateway, "nextTurn(diceCounter: 3)", "WebSocket")
Rel(gameGateway, gameEngine, "nextTurn(playerId, diceCounter)", "Method call")

note right of gameEngine
  1. Validate active player
  2. Roll dice
  3. Move player
  4. Handle cell events
  5. Update turn state
end note

Rel(gameEngine, gameGateway, "Return ITurnResult", "Response")
Rel(gameGateway, angular1, "turn_progress", "WebSocket broadcast")
Rel(gameGateway, angular2, "turn_progress", "WebSocket broadcast")

Rel(angular1, player1, "Update UI", "Visual feedback")
Rel(angular2, player2, "Update UI", "Visual feedback")

@enduml